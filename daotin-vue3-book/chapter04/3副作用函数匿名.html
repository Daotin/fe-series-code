<body>
	<div id="app"></div>
	<input type="text" onInput="inputChange(event)" />
</body>

<script>
	const app = document.getElementById('app')

	const data = { text: 'hello vue3' }

	const bucket = new Set()

	let activeEffect
	function effect(fn) {
		activeEffect = fn
		fn && fn()
	}

	let obj = new Proxy(data, {
		get(target, key) {
			if (activeEffect) {
				bucket.add(activeEffect)
			}
			return target[key]
		},
		set(target, key, value) {
			target[key] = value
			bucket.forEach(fn => fn())
		},
	})

	// 副作用函数
	effect(() => {
		console.log('do effect')
		app.innerText = obj.text
	})

	// 触发响应式数据改变
	function inputChange(e) {
		let value = e.target.value
		console.log(value)
		obj.text = value
	}
</script>
